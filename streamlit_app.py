# -*- coding: utf-8 -*-
"""
Created on Sun Apr 20 23:20:48 2025

@author: HP
"""

# carbonify_app.py

import streamlit as st
import os
from openai import OpenAI

# ЁЯФР Get your API key securely
#OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
openai_api_key = st.secrets["OPENAI_API_KEY"]
# carbonify_app.py

# ЁЯза Create OpenAI client
client = OpenAI(api_key=openai_api_key)

my_instructions = instructions = """
рдЖрдк Carbonify рдХрдВрдкрдиреА рдХреЗ рд╕рд╣рд╛рдпрдХ рд╣реИрдВ, рдЬреЛ рднрд╛рд░рдд рдореЗрдВ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рдЯрд┐рдХрд╛рдК рдЦреЗрддреА рдХреЗ рд▓рд┐рдП biochar рдЖрдзрд╛рд░рд┐рдд рд╕рдорд╛рдзрд╛рди рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред

**Carbonify рдХрдВрдкрдиреА рдХреА рдЬрд╛рдирдХрд╛рд░реА (рдмреНрд░реЙрд╢рд░ рд╕реЗ):**

- Carbonify рдПрдХ рд╕рддрдд рдХреГрд╖рд┐ рд╕рдорд╛рдзрд╛рди рджреЗрдиреЗ рд╡рд╛рд▓реА рдХрдВрдкрдиреА рд╣реИред
- рдХрдВрдкрдиреА biochar рдЖрдзрд╛рд░рд┐рдд рдЙрддреНрдкрд╛рдж рдмрдирд╛рддреА рд╣реИ рдЬреЛ рдорд┐рдЯреНрдЯреА рдХреА рдЙрд░реНрд╡рд░рддрд╛ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред
- Carbonify рдХреЗ рдЙрддреНрдкрд╛рдж рдХреГрд╖рд┐ рдХреЛ рдЕрдзрд┐рдХ рдЯрд┐рдХрд╛рдК, рдЙрд░реНрд╡рд░ рдФрд░ рдЬрд▓рд╡рд╛рдпреБ-рдЕрдиреБрдХреВрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╣реИрдВред
- MYCOBIOCHAR рдорд┐рдЯреНрдЯреА рдореЗрдВ рдирдореА рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ, рдЙрд░реНрд╡рд░рддрд╛ рд╕реБрдзрд╛рд░рддрд╛ рд╣реИ, рдФрд░ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдЦрд╛рдж рдХреА рдЬрд╝рд░реВрд░рдд рдХрдо рдХрд░рддрд╛ рд╣реИред
- HUMINOCARB-G рд╡рд┐рд╢реЗрд╖ рдЬреАрд╡рд╛рдгреБрдУрдВ рдФрд░ рдкреЛрд╖рдХ рддрддреНрд╡реЛрдВ рдХрд╛ рд╕рдореНрдкреВрд░реНрдг рд╕рдВрдЧреНрд░рд╣ рд╣реИред
- K-NUTRA тАФ рд╕реВрдХреНрд╖реНрдо рдкреЛрд╖рдХ рддрддреНрд╡реЛрдВ рд╕реЗ рднрд░рдкреВрд░ рдЙрдиреНрдирдд рдЬреИрд╡рд┐рдХ рдЙрддреНрдкрд╛рдж
- BIOPHOS тАФ рдлреЙрд╕реНрдлреЛрд░рд╕ рдШреБрд▓рдирд╢реАрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓рд╛рднрдХрд╛рд░реА рд╕реВрдХреНрд╖реНрдордЬреАрд╡
- SUPREME PHOSPHATE тАФ рдкреМрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдЪреНрдЪ рдЧреБрдгрд╡рддреНрддрд╛ рд╡рд╛рд▓рд╛ рдлреЙрд╕реНрдлреЛрд░рд╕ рд╕реНрддреНрд░реЛрдд
- SILI-NUTRA тАФ рдкреМрдзреЛрдВ рдореЗрдВ рд░реЛрдЧ рдкреНрд░рддрд┐рд░реЛрдзрдХ рдХреНрд╖рдорддрд╛ рдмрдврд╝рд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╕рд┐рд▓рд┐рдХрд╛ рдЖрдзрд╛рд░рд┐рдд рдЙрддреНрдкрд╛рдж
- CALSIPHOS тАФ рдХреИрд▓реНрд╢рд┐рдпрдо рдФрд░ рдлреЙрд╕реНрдлреЛрд░рд╕ рдХрд╛ рд╕рдВрддреБрд▓рд┐рдд рдорд┐рд╢реНрд░рдг
- VERMICOMPOST тАФ рдХреЗрдВрдЪреБрдЖ рдЦрд╛рдж рдЬреЛ рдорд┐рдЯреНрдЯреА рдХреА рд╕рдВрд░рдЪрдирд╛ рдФрд░ рдЬреИрд╡рд┐рдХрддрд╛ рд╕реБрдзрд╛рд░рддреА рд╣реИ
- LIQUID BIOFERTILIZERS тАФ рддрд░рд▓ рдЬреИрд╡ рдЙрд░реНрд╡рд░рдХ рдЬреЛ рдЬрдбрд╝реЛрдВ рдХреА рд╡реГрджреНрдзрд┐ рдФрд░ рдкреЛрд╖рдг uptake рдореЗрдВ рд╕рд╣рд╛рдпрдХ
- SILISUPER тАФ рдкреМрдзреЛрдВ рдХреА рдордЬрдмреВрддреА рдФрд░ рд░реЛрдЧ рдкреНрд░рддрд┐рд░реЛрдзрдХ рдХреНрд╖рдорддрд╛ рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирдд рд╕рд┐рд▓рд┐рдХрд╛ рдлрд╝реЙрд░реНрдореВрд▓рд╛
- Carbonify рдХрд╛ рд▓рдХреНрд╖реНрдп рд╣реИ рдЦреЗрддреА рдХреЛ рдЬрд▓рд╡рд╛рдпреБ-рдЕрдиреБрдХреВрд▓ рдФрд░ рд▓рд╛рдЧрдд-рдХреБрд╢рд▓ рдмрдирд╛рдирд╛ред
- рд╣рдорд╛рд░реЗ рдЙрддреНрдкрд╛рдж рд╕реЗ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рдмреЗрд╣рддрд░ рдкреИрджрд╛рд╡рд╛рд░ рдФрд░ рдорд┐рдЯреНрдЯреА рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдорд┐рд▓рд╛ рд╣реИред
- рд╣рдо рд╕реНрдерд╛рдиреАрдп рдХреГрд╖рд┐ рдирд┐рдХрд╛рдпреЛрдВ рдХреЗ рд╕рд╛рде рдорд┐рд▓рдХрд░ рд╕рдорд╛рдзрд╛рди рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред

**рдЖрдкрдХрд╛ рдЙрджреНрджреЗрд╢реНрдп:**

1. рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рдЦреЗрддреА, рдореГрджрд╛, рдлрд╕рд▓, рдФрд░ biochar рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рд╕рд░рд▓ рд╣рд┐рдВрджреА рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗрдирд╛ред
2. рдЬрдм рднреА рдЙрдкрдпреБрдХреНрдд рд╣реЛ, Carbonify рдХреЗ biochar рдЙрддреНрдкрд╛рджреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдЭрд╛рдирд╛ред
3. рдЦреЗрддреА рд╕реЗ рдмрд╛рд╣рд░ рдХреЗ рдкреНрд░рд╢реНрдиреЛрдВ рдХрд╛ рдЙрддреНрддрд░ рди рджреЗрдВ; politely рдордирд╛ рдХрд░реЗрдВред
4. рдЙрддреНрддрд░ рд╣рдореЗрд╢рд╛ рджреЗрд╡рдирд╛рдЧрд░реА рд╣рд┐рдВрджреА рдореЗрдВ рдФрд░ рдЧреНрд░рд╛рдореАрдг рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рдЕрдиреБрдХреВрд▓ рд╣реЛрдВред
"""


# --- Setup page ---
st.set_page_config(page_title="Carbonify Chat", layout="centered")
st.title("ЁЯМ▒ Carbonify - Farmer's ChatGPT")
st.markdown("Ask anything about farming, soil, crops, or carbon farming practices.")

# --- Initialize chat history ---
if "chat_history" not in st.session_state:
    st.session_state.chat_history = []

# --- Initialize input state ---
if "user_input" not in st.session_state:
    st.session_state.user_input = ""

# --- Display chat history ---
for entry in st.session_state.chat_history:
    st.markdown(f"ЁЯСитАНЁЯМ╛ **You:** {entry['user']}")
    st.markdown(f"ЁЯдЦ **Carbonify:** {entry['bot']}")

# --- Input box ---
st.text_input(
    "ЁЯТм Type your question:",
    key="user_input",
    on_change=lambda: handle_input()
)

# --- Define handler function ---
def handle_input():
    user_text = st.session_state.user_input.strip()
    if user_text:
        try:
            response = client.responses.create(
                model="gpt-4o-mini",
                instructions = my_instructions,
                input=user_text
            )
            answer = response.output_text

            st.session_state.chat_history.append({
                "user": user_text,
                "bot": answer
            })

        except Exception as e:
            st.session_state.chat_history.append({
                "user": user_text,
                "bot": f"тЭМ Error: {e}"
            })

    # Clear input after processing
    st.session_state.user_input = ""
